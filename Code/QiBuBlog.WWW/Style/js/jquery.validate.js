/*!
* Form Validation Plugin v1.0.0 For jQuery 1.3+
* http://heeroluo.net/
*
* Copyright 2011, Heero.Luo
* Dual licensed under the MIT or GPL Version 2 licenses.
*
* Date: Thu Apr 26 2012 16:10:28 GMT+0800
*/
(function(a,b){"use strict",a.fn.validate=function(b){return this.each(function(c,d){new a.validate(a(d),b)})},a.validate=function(b,c){var d=this,e=a.extend({},a.validate.defaults,c);d.options=e,d._el=b;if(!e.flow||!b.length)return;d._explainFlow(),e.enableBlurChecking&&d._bindCheckingWhenBlur(),d._bindCheckingWhenSubmit()},a.extend(a.validate.prototype,{_explainFlow:function(){var c=this.options.flow;a.each(c,function(d,e){var f=e.rules,g=typeof f;if(!f)return;"string"===g&&(f=f.split(/\s*;\s*/)),g!="function"?(a.each(f,function(c,d){if("string"==typeof d){d=d.split(/\s*[:,]\s*/);var e=a.validate.rules[d[0]];d[0]=b,f[c]=function(a,b){return function(c){return b=b.slice(),b[0]=c,a.apply(this,b)}}(e,d)}}),c[d].rules=f):c[d].rules=[f]})},fieldCorrect:function(a){var b=this,c=b.options,d=b._extraErrors,e;c.onfieldcorrect&&c.onfieldcorrect.call(b,a)},fieldError:function(a,b,c){var d=this,e=d.options;e.onfielderror&&e.onfielderror.call(d,a,b)},_checkSingleField:function(b,c,d){var e,f=this;return!1!==b.required&&!c&&(e=b.errorText),!e&&c&&b.rules&&a.each(b.rules,function(a,g){if(!1===g.call(f,c,d))return e=b.errorText,!1}),e},_bindCheckingWhenBlur:function(){var b=this,c=b.options;a("[name][type!=hidden][type!=button][type!=submit]",b._el).blur(function(){if(this.getAttribute("data-ignorecheck"))return;var c=a.trim(this.value),d=a(this),e=b.options.flow,f,g,h;a.each(e,function(a,i){i=e[a];if(i.fields===d.get(0).name){i.isAsync&&(g=!0),h=i.required,f=b._checkSingleField(i,c,d);if(f)return!1}}),f?b.fieldError(d,f):!g&&(h!==!1||c)&&b.fieldCorrect(d)})},val:function(){var b=this._el.serializeArray(),c={};return a.each(b,function(b,d){var e=d.name;c[e]=c[e]||[],c[e].push(a.trim(d.value))}),a.each(c,function(a,b){b!=null&&(b.length>1?o.multiValueSeparator!=null&&(c[a]=b.join(", ")):c[a]=b[0])}),c},_bindCheckingWhenSubmit:function(){var b=this,c=b.options;b._el.bind("submit",function(d){var e=this;c.beforeformvalidate&&c.beforeformvalidate.call(b,e);var f=b.val(),g=[],h;a.each(c.flow,function(c,d){var i,j,k;d.fields&&(i=d.fields.split(/\s*,\s*/),k=a("[name="+i.join("], [name=")+"]",e));if(!i||i.length>1){var l=[];i&&a.each(i,function(a,b){l[a]=f[b]}),l.push(k),!1===d.rules[0].apply(b,l)&&(j=d.errorText)}else j=b._checkSingleField(d,f[d.fields],k);j&&(g.push(j),!h&&k&&(h=a(k.get(0))))});var i=g.length>0;c.afterformvalidate&&c.afterformvalidate.call(b,e,i),i?(d.preventDefault(),c.onformerror&&c.onformerror.call(b,g,h)):c.submit&&c.submit.call(b,e,d,f)})}}),a.validate.defaults={enableBlurChecking:!1,multiValueSeparator:", ",onformerror:function(a,b){alert(a.join("\r\n")),b&&b.focus()}},a.validate.rules={min:function(a,b){return Number(a)>=b},max:function(a,b){return Number(a)<=b},minlength:function(a,b){return a.length>=b},maxlength:function(a,b){return a.length<=b},oneof:function(a){for(var b=arguments.length;b>=1;b--)if(arguments[b]!==a)return!1;return!0},isemail:function(a){return/^([.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]+)*)\.[a-zA-Z]+$/.test(a)}}})(jQuery)