!function(a){"use strict";var b={url:"/Comment/List",wrapper:a("#comment-list > div"),articleId:a("#comment-articleid").val(),listTemplate:'<# for (var i = 0; i < data.length; i++) { #><article<# if (data[i].AuthorId > 0) { #> class="comment-by-blogger"<# } #>>    <header>        <address class="comment-author">    <# if (data[i].HomePage) { #>        <a href="<#=data[i].HomePage #>" target="_blank"><#=data[i].AuthorName #></a>    <# } else { #>        <#=data[i].AuthorName #>    <# } #></address> \u5728 <time><#=dateUtility.iFormat(dateUtility.parseCSharpJSONDate(data[i].PostTime)) #></time> \u8bf4\uff1a    </header>    <div class="comment-content"><#=httpUtility.htmlEncode(data[i].Content).replace(/\\r\\n/g, "<br />") #></div></article><# } #><div class="pager"></div>',tipsTemplate:'<p class="comment-tips"><#=tips#></p>',init:function(){this.articleId&&this.load(1)},load:function(b,c){var d=this;this.wrapper.empty().html(a.ui.parseTpl(this.tipsTemplate,{tips:"\u6b63\u5728\u8bfb\u53d6\u8bc4\u8bba\uff0c\u8bf7\u7a0d\u5019..."})),a.ajax({url:this.url,dataType:"json",data:{articleId:this.articleId,page:b},success:function(a){d.render(a,c)}})},render:function(c,d){c.Data&&c.Data.length?(this.wrapper.html(a.ui.parseTpl(this.listTemplate,{data:c.Data})),a("div.pager",this.wrapper).pager({pageCount:c.PageCount,currentPage:c.CurrentPage,hrefTpl:"#comment-<#=page#>",onclick:function(a){/comment-(\d+)$/.test(this.href)&&(a.preventDefault(),b.load(RegExp.$1,!0))}})):this.wrapper.html(a.ui.parseTpl(this.tipsTemplate,{tips:"\u6682\u65e0\u8bc4\u8bba"})),d&&(window.location.hash="comment-list")}};b.init();var c=new Captcha(a("div.captcha")),d=parseInt(a("#comment-minlength").val()),e=parseInt(a("#comment-maxlength").val()),f=[{fields:"Content",errorText:"\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u5c11\u4e8e"+d+"\u4e2a\u5b57",rules:function(a){return a.length>=d}},{fields:"Content",errorText:"\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u591a\u4e8e"+e+"\u4e2a\u5b57",required:!1,rules:function(a){return a.length<=e}}];a("p.comment-user").length||f.push({fields:"Email",rules:"isemail",errorText:"Email\u683c\u5f0f\u9519\u8bef",required:!1},{fields:"AuthorName",errorText:"\u8bf7\u586b\u5199\u60a8\u7684\u79f0\u547c"},{fields:"captcha",errorText:"\u8bf7\u586b\u5199\u9a8c\u8bc1\u7801"}),a("div.comment-form form").validate({flow:f,submit:function(d,e,f){e.preventDefault();var g=a("input[type=submit]",d);if(g.attr("disabled")){alert("\u6b63\u5728\u63d0\u4ea4\u8bc4\u8bba\uff0c\u8bf7\u7a0d\u540e");return}g.val("\u53d1\u8868\u4e2d\uff0c\u8bf7\u7a0d\u540e").attr("disabled",!0),a.ajax({url:d.action,type:"POST",dataType:"json",data:f,success:function(e){e.Message&&alert(e.Message),e.hasOwnProperty("CommentData")&&(e.CommentData!=null&&b.render(e.CommentData,!0),a(d).trigger("reset")),c.refresh()},complete:function(){g.val("\u53d1 \u8868").attr("disabled",!1)}})}}).bind("reset",function(){var b=this;setTimeout(function(){a("[name]",b).blur()},10)})}(jQuery)